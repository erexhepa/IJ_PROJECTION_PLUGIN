

%% Finding the W parameter (New)
%%
                                    [ncf,hcf]=hist(valk(edgeflag2==1),linspace(min(valk(:)),max(valk(:)),100));
                                    ncf=ncf/sum(ncf);

                                    [ncb,hcb]=hist(valk(edgeflag2==0),linspace(min(valk(:)),max(valk(:)),100));
                                    ncb=ncb/sum(ncb);

                                    nt= find(ncb>ncf,1,'last');
                                    ht=hcb(nt);
                                    idmaxini=idmax;

overlap2=sum(valk(edgeflag2==1)<=ht)./sum(valk(edgeflag2==1)>ht);

                    edgeflag2B = padarray(edgeflag2',1,'symmetric');
                     edgeflag2IB = padarray(edgeflag2B',1,'symmetric');

                     base1=find_base2(edgeflag2IB,3);
                       class3=sum(base1==1,3);

                      idmaxk=idmax;

                         idmaxkB = padarray(idmaxk',1,'symmetric');
                     IB = padarray(idmaxkB',1,'symmetric');

                     base=find_base(IB,3);
                           Mold=mean(base,3);
                         varold2=sum((base-repmat(Mold,[1 1 8])).^2,3);

                         M10=idmaxk-Mold;
                          MD=Mold-Mold;

                           s01=sqrt((varold2+(M10).*(idmaxk-(Mold+(M10)./9)))./8);

                           sD=sqrt((varold2+(MD).*(Mold-(Mold+(MD)./9)))./8);

                           sgain=s01-sD;
                           dD=abs(idmax-Mold);
                           sg=sgain(class3>8 & edgeflag2==1);
                           dg=dD(class3>8 & edgeflag2==1);

                          sgk=sg;
                           sg(sgk==0)=[];
                           dg(sgk==0)=[];

                                WA=dg./sg;
                           WW=abs(quantile(WA(:),overlap2))

%%
%%
